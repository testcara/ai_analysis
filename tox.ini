[tox]
envlist = py311,py312,py313,lint,type
skipsdist = False
isolated_build = True

# Quick test commands:
#   tox -e unittest --develop        # Fast unit tests (~0.1s, skips rebuild) - RECOMMENDED
#   tox -e py311 --develop           # Same as unittest (uses Python 3.11)
#   tox -e coverage --develop        # With coverage report
#   tox -e lint                      # Code quality checks
#   tox -e jira-integration          # Slow! Real API calls to Jira (requires credentials)
#   tox -e github-integration        # Slow! Real API calls to GitHub (requires credentials)

[testenv]
description = Run unit tests (excluding integration tests)
# Tip: Use 'tox -e unittest --develop' for faster runs (skips rebuild)
deps =
    pytest>=7.0
    pytest-cov>=4.0
    -r{toxinidir}/requirements.txt
commands =
    pytest --ignore=tests/test_jira_integration.py --ignore=tests/test_github_integration.py -v {posargs}

[testenv:unittest]
description = Run unit tests (alias for py311, more intuitive name)
deps = {[testenv]deps}
commands = {[testenv]commands}

[testenv:lint]
description = Run code quality checks (flake8, black)
deps =
    flake8>=6.0
    black>=23.0
commands =
    flake8 ai_impact_analysis bin tests
    black --check ai_impact_analysis bin tests

[testenv:type]
description = Run type checking with mypy
deps =
    mypy>=1.0
    types-requests
    -r{toxinidir}/requirements.txt
commands =
    mypy ai_impact_analysis bin

[testenv:format]
description = Auto-format code with black
deps =
    black>=23.0
commands =
    black ai_impact_analysis bin tests

[testenv:coverage]
description = Run tests with coverage report
deps =
    pytest>=7.0
    pytest-cov>=4.0
    -r{toxinidir}/requirements.txt
commands =
    pytest --ignore=tests/test_jira_integration.py --ignore=tests/test_github_integration.py --cov=ai_impact_analysis --cov-report=html --cov-report=term-missing -v {posargs}

[testenv:jira-integration]
description = Run integration tests with real Jira API calls (SLOW! requires credentials)
passenv = JIRA_URL,JIRA_API_TOKEN,JIRA_PROJECT_KEY,JIRA_USER_EMAIL
deps =
    pytest>=7.0
    -r{toxinidir}/requirements.txt
commands =
    pytest tests/test_jira_integration.py -v {posargs}

[testenv:github-integration]
description = Run GitHub integration tests with real API calls (SLOW! requires credentials)
passenv = GITHUB_TOKEN,GITHUB_REPO_OWNER,GITHUB_REPO_NAME
deps =
    pytest>=7.0
    -r{toxinidir}/requirements.txt
commands =
    pytest tests/test_github_integration.py -v -s {posargs}

[flake8]
max-line-length = 100
extend-ignore = E203, E501, W503
exclude =
    .git,
    .tox,
    build,
    dist,
    venv,
    __pycache__,
    *.egg-info

[pytest]
minversion = 7.0
addopts = -ra -q --strict-markers
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*
